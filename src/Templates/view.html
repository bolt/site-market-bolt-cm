{% extends "layout.html" %}

{% block ga_extras %}
    ga('set', 'page', '/view/<package-uuid>');
    ga('set', 'dimension2', '{{package.id}}');
    ga('set', 'dimension3', '{{package.title}}');
{% endblock %}

{% block header_title %} | {{package.title}}{% endblock %}

{% block content %}
    <div class="ui grid stackable">
        <div class="eight wide column">
            <h2 class="ui header">
                <img class="ui rounded image" src="{{packageIcon(package)}}">
                <div class="content">
                    {{package.title}}
                    <div class="sub header">by {{package.authors}}</div>
                </div>
            </h2>
            <!-- <div>Last Update: 13/08/2015</div> -->
        </div>
        <div class="right floated right aligned eight wide column">

            <div class="buttons_header">

                {% if request.get('isLoggedIn') and request.get('user').id == package.account.id %}
                    <div class="buttons_header">
                        <a href="{{url('edit',{'package':package.id})}}" class="ui primary button">
                            Edit
                            <i class="right wrench icon"></i>
                        </a>
                        <a href="{{url('update',{'package':package.id})}}" class="ui orange button">
                            Update
                            <i class="right repeat icon"></i>
                        </a>
                    </div>
                {% endif %}

                {% if boltthemes and boltthemes.active %}
                    <a class="ui orange button" href="{{ boltthemes.preview_page }}?utm_source=bolt-extension-store&utm_medium=detailpage&utm_term=livepreview&utm_content=theme-livepreview&utm_campaign={{ package.title|url_encode }}" target="_blank" onclick="ga('send', 'event', {
                        eventCategory: 'Package',
                        eventAction: 'Live Preview',
                        eventLabel: '{{package.title}}'
                      });">
                        View Live Preview
                    </a>
                {% endif %}
                <button class="ui toggle button" id="copy-button" data-content="{{ package.name }}" data-title="Click to copy the package name" data-clipboard-text="{{ package.name }}"><i class="alternate copy icon"></i> Copy to clipboard</button>
                <button class="ui green button">FREE</button>
            </div>

            <div class="ui right floated main menu">
                <a class="bug popup icon item" data-content="Downloads" href="#">
                    <i class="download icon"> {{package.downloads|default(0)}}</i>
                </a>

                <a class="bug popup icon item"
                {% if request.get('isLoggedIn') %}
                    {% if package.isStarredBy(request.get('user')) %}
                    {% else %}
                         href="{{url('star',{'package':package.id})}}"
                         onclick="ga('send', 'event', {
                            eventCategory: 'Package',
                            eventAction: 'Star',
                            eventLabel: '{{package.title}}'
                          });"
                    {% endif %}
                {% endif %}
                data-content="
                {% if request.get('isLoggedIn') %}
                    {% if package.isStarredBy(request.get('user')) %}
                        You have starred this package.
                    {% else %}
                        Star this package!
                    {% endif %}
                {% else %}
                    You must be login to star packages.
                {% endif %}
                ">
                    <i class="star icon"> {{package.stars|default(0)}}</i>
                </a>

                <a class="github popup icon item" data-content="View source code" target="_blank" href="{{package.source}}"
                    onclick="ga('send', 'event', {
                            eventCategory: 'Package',
                            eventAction: 'View Source',
                            eventLabel: '{{package.title}}'
                          });"
                >
                    {% if "github.com" in package.source %}
                        <i class="alternate github icon"></i>
                    {% else %}
                        <i class="alternate code icon"></i>
                    {% endif %}
                </a>
            </div>
        </div>
    </div>

    <br>


    {% if package.screenshots %}
        <h2 class="ui left floated header">Screenshots</h2>
        <div class="ui clearing divider"></div>
        <div class="slide_gallery scrollbar-inner">
            <div class="gallery" id="scroll_gallery">
                {% for image in package.screenshots%}
                    {% if "//" in image %}
                        <img class="image_gallery" src="{{image}}">
                    {% else %}
                        <img class="image_gallery" src="{{package.source|replace({ ('github.com'): 'raw.githubusercontent.com'})}}/master/{{image}}">
                    {% endif %}
                {% endfor %}
            </div>

        </div>
        <br>
    {% endif %}

    <div class="ui grid stackable">

        <div class="ten wide column">
            <h2 class="ui left floated header">Description</h2>
            <div class="ui clearing divider"></div>
            <p style="font-size: 110%;">{{package.description}}</p>
        </div>

        <div class="six wide column">
            <h2 class="ui left floated header">More Info</h2>
            <div class="ui clearing divider"></div>

            <div class="ui relaxed large divided list">
                <div class="item">
                    <i class="large file code outline middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Created</span>
                        <div class="description">{{package.created.date|date('jS M Y')}}</div>
                    </div>
                </div>
                <div class="item">
                    <i class="large flag outline middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Latest Version</span>
                        <div class="description">
                            {% if package.versions %}
                                {{ package.versions|first }}
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="item">
                    <i class="large history middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Last Update</span>
                        <div class="description">
                            {{ package.updated|date('jS F Y') }}
                        </div>
                    </div>
                </div>
                <div class="item">
                    <i class="large folder outline middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Category</span>
                        <div class="description">
                            {% if "bolt-extension" == package.type %}
                            Plugin
                            {% else %}
                            Theme
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="item">
                    <i class="large tags middle aligned icon"></i>
                    <div class="content">
                        <span class="header">Tags</span>
                        <div class="description">
                            {% for tag in package.keywords %}
                                <a href="{{url('browse')}}?q={{tag}}"><span class="label tags">{{tag}}</span></a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="sixteen wide column">
            <h2 class="ui left floated header">Changelog &amp; Releases</h2>
            <div class="ui clearing divider"></div>

            <div class="releases-wrapper">
                Loading releases ...
            </div>
        </div>



        <div class="ten wide column">
            <h2 class="ui left floated header">Comments</h2>
            <div class="ui clearing divider"></div>
            {% include '_disqus_comments.html' %}
        </div>

        <div class="six wide column">
            {% if package.suggested %}
                <h2 class="ui left floated header">Suggested Packages</h2>
                <div class="ui clearing divider"></div>

                <div class="ui relaxed large divided vertical list related_list">
                    {% for suggest in suggested %}
                        {% if suggest.package != package %}
                            <div class="item">
                                <img class="ui avatar image" src="/images/{{ suggest.package.type }}.png">
                                <div class="content">
                                    <a class="header" href="{{url('view',{'package':suggest.package.id})}}">{{suggest.package.title}}</a>
                                    {{suggest.description}}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}

            <h2 class="ui left floated header">Related</h2>
            <div class="ui clearing divider"></div>

            <div class="ui relaxed large divided vertical list related_list">
                {% for related in package.account.packages |slice(0, 7) %}
                    {% if related != package %}
                        <div class="item">
                            <img class="ui avatar image" src="/images/{{ related.type }}.png">
                            <div class="content">
                                <a class="header" href="{{url('view',{'package':related.id})}}">{{related.title}}</a>
                                {{related.name}}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

    </div>


{% endblock %}

{% block header_extra_scripts %}
<script>
    var packageID = "{{package.id}}";
</script>

<script src="/js/jquery.scrollbar.min.js"></script>
<script src="//cdn.jsdelivr.net/zeroclipboard/2.2.0/ZeroClipboard.min.js"></script>
<script src="/js/extension-extras.js"></script>
{% endblock %}
